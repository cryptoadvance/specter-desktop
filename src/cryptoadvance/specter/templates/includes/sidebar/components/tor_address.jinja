<style>
    #onion-address-container {
        max-width: 220px;
        padding: 10px;
        margin: 10px;
        background: #7D4698;
        border-radius: 10px;
    }

    #tor-open-btn {
        position: absolute;
        cursor: pointer;
        margin-left: 210px;
        width: 24px;
    }

    #tor-close-btn {
        cursor: pointer;
        color: #fff;
        font-size: 0.8em;
        float: right;
        margin-bottom: 5px;
    }

    .onion-address {
        word-wrap: break-word;
        color: #fff;
        font-size: 0.7em;
        text-decoration: none;
    }

    .onion-address:hover {
        text-decoration: underline;
        cursor: pointer;
    }

    .dot {
        cursor: pointer;
        height: 8px;
        width: 8px;
        position: absolute;
        border-radius: 50%;
        display: inline-block;
    }

    .dot-on {
        {% if tor_enabled %}
            background-color: #0f0;
        {% else %}
            background-color: #ccc;
        {% endif %}
    }

    .dot-off {
        {% if tor_enabled %}
            background-color: #f00;
        {% else %}
            background-color: #ccc;
        {% endif %}
    }

    .tor-btn {
        margin-top: 10px;
        width: 90px;
        border: none;
        font-size: 0.8em;
        color: #fff;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #59316B;
        background: #7D4698;
    }

    .tor-btn:hover {
        cursor: pointer;
        background: #59316B;
    }
</style>
<div style="position: relative;">
<img id="tor-open-btn" src="/static/img/tor.svg"/>
<span class="dot {% if tor_service_id %}dot-on{% else %}dot-off{% endif %}" id="tor-symbol-status-dot" style="margin-left: 227px;"></span>
</div>
<div id="onion-address-container" class="hidden">
    <div style="position: relative;">
        <img id="tor-close-btn" src="/static/img/tor.svg" style="width: 24px; position: absolute; left: 177px;"/>
        <span class="dot {% if tor_service_id %}dot-on{% else %}dot-off{% endif %}" id="tor-popup-status-dot" style="left: 193px;"></span>
    </div>
    {% if tor_service_id %}
        <span style="font-size: 0.92em; color: #fff;">Specter Running on Tor</span><br>
        <div style="margin-top: 5px;"> <span style="font-size: 0.75em; color: #fff;">Running at:</span></div>
        <div class="center">
            <span title="Copy Tor address" class="onion-address centered" onclick="copyText('{{ tor_service_id }}.onion', 'Copied Tor hidden service address: {{ tor_service_id }}.onion')">
            {{ tor_service_id }}.onion
            </span>
        </div>
        {% if current_user.is_admin and (tor_service_id and tor_service_id + '.onion' not in request.url) %}
            <form action="?" class="center">
                <button class="tor-btn" type="submit" name="action" value="stoptor">Stop Tor</button>
            </form>
        {% endif %}
    {% else %}
        {% if debug %}
            <span style="font-size: 0.92em; color: #fff;">Tor is unavailable...</span><br>
            <div style="margin-top: 5px;">
                <span style="font-size: 0.75em; color: #fff;">You are running Specter in debug mode, but Tor hidden serices are only available in production mode.</span>
            </div>
        {% else %}
            <span style="font-size: 0.92em; color: #fff;">Tor service is down...</span><br>
            {% if current_user.is_admin and ('.onion' not in request.url) %}
                <form action="?" class="center">
                    <button class="tor-btn" type="submit" name="action" value="starttor">Start Tor</button>
                </form>
            {% endif %}
        {% endif %}
    {% endif %}
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        let torOpenBtn = document.getElementById('tor-open-btn');
        let torCloseBtn = document.getElementById('tor-close-btn');
        let torDataContainer = document.getElementById('onion-address-container');
        let torPopupStatusDot = document.getElementById('tor-popup-status-dot');
        let torSymbolStatusDot = document.getElementById('tor-symbol-status-dot');

        function openTorPopup() {
            torOpenBtn.style.display = 'none';
            torDataContainer.style.display = 'block';
            torPopupStatusDot.style.display = 'inline-block';
            torSymbolStatusDot.style.display = 'none';
        }

        function closeTorPopup() {
            torOpenBtn.style.display = 'block';
            torDataContainer.style.display = 'none';
            torPopupStatusDot.style.display = 'none';
            torSymbolStatusDot.style.display = 'inline-block';
        }
        torSymbolStatusDot.addEventListener("click", openTorPopup);
        torOpenBtn.addEventListener("click", openTorPopup);

        torPopupStatusDot.addEventListener("click", closeTorPopup);
        torCloseBtn.addEventListener("click", closeTorPopup);
    });
</script>